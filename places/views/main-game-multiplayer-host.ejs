<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivia Game Host</title>
    <link rel="stylesheet" href="/places/style/main-game-multiplayer-host.css">
</head>
<body>
    <div id="question-container">
        <!-- Question will be displayed here -->
    </div>
    <div id="participants">
        <h3>Joined Participants</h3>
    </div>

    <div id="start-game-button">
        <button id="startExploringBtn">Start Exploring</button>
    </div>

    <div id="category-buttons" style="display:none;">
        <!-- Category buttons will be dynamically added here -->
    </div>

    <div id="nationalParks" style="display:none;">
        <img id="parkImage" src="" alt="National Park" style="max-width: 100%; height: auto;">
        <button id="nextParkBtn">Next</button>
    </div>

    <script src="http://localhost:8000/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // Listen for player join updates
        socket.on('playerJoined', (playerData) => {
            const participantsDiv = document.getElementById('participants');
            participantsDiv.innerHTML += `<p>${playerData.nickname}</p>`;
        });

        // Fetch categories and dynamically create buttons
        function fetchCategoriesAndCreateButtons() {
            fetch('/api/categories')
                .then(response => response.json())
                .then(categories => {
                    const categoryButtonsDiv = document.getElementById('category-buttons');
                    categoryButtonsDiv.innerHTML = ''; // Clear existing buttons
                    categories.forEach(category => {
                        const button = document.createElement('button');
                        button.textContent = category.name;
                        button.addEventListener('click', function() {
                            // Hide other elements and show relevant section based on the category
                            document.getElementById('category-buttons').style.display = 'none';
                            if (category.name === 'North American National Parks') {
                                document.getElementById('nationalParks').style.display = 'block';
                                fetchNextPark(); // Fetch the first park image
                            }
                            // Call a function to handle category selection (e.g., fetch questions for the category)
                            generateQuestionsForCategory(category.name);
                        });
                        categoryButtonsDiv.appendChild(button);
                    });
                })
                .catch(error => console.error('Error fetching categories:', error));
        }

        // Handle start exploring button click
        document.getElementById('startExploringBtn').addEventListener('click', function() {
            document.getElementById('participants').style.display = 'none';
            document.getElementById('start-game-button').style.display = 'none';
            fetchCategoriesAndCreateButtons(); // Fetch categories and create buttons dynamically
            document.getElementById('category-buttons').style.display = 'block'; 
        });

        function fetchNextPark() {
            fetch('/getNationalParkImage')
                .then(response => response.json())
                .then(data => {
                    const imageUrl = data.imageUrl;
                    document.getElementById('parkImage').src = imageUrl;
                })
                .catch(error => console.error('Error fetching park image:', error));
        }

        function generateQuestionsForCategory(category) {
            fetch('/places/generate_questions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ category: category, num_questions: 5 })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log(data.questions);
                // Update UI with questions here
            })
            .catch(error => {
                console.error('Error fetching questions:', error);
            });
        }
    </script>

    <div class="back-to-home">
        <a href="/places" class="back-to-home-btn">Go Back</a>
    </div>
</body>
</html>
